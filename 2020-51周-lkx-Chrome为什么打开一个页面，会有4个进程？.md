# Chrome为什么打开一个页面，会有4个进程？

## 进程和线程的概念混淆

从计算的角度来说，单线程就是一个接一个的计算，多线程就是同时处理多个计算。多线程是指程序中包含多个执行流，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，就是说允许单个程序创建多个并行执行。
单线程是程序中的一个执行流，每个线程都有自己的专有寄存器(栈指针、程序计数器等)，但代码区是共享的，即不同的线程可以执行同样的函数。

单线程在程序执行时，所走的程序都是按照连续顺序下来的，前面的必须处理好，才会执行后面的。多线程运行就是一个进程内有多个相对独立的并且实现特定的任务以竞争CPU的方式执行

每个正在运行的程序即是进程，至少包含一个线程，这个线程叫主线程，它在程序启动时被创建，用于执行main函数。只有一个主线程的程序，称为单线程程序。拥有多个线程的程序，称为多线程程序。
进程是当一个程序开始运行时，它就是一个进程，进程包括运行中的程序和程序所使用到的内存和系统资源（一个进程又是由多个线程所组成的）

多线程的好处就是可以提高CPU的利用率，在多线程程序中，如果一个线程必须等待的时候，CPU可以运行其它的线程而不是等待，这样可以大大地提高程序的效率。

所以，线程是不能单独存在的，它是由进程来启动和管理的，一个进程就是一个程序的运行实例。线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率。线程之间共享进程中的数据。当一个进程关闭后，操作系统会回收进程所占用的内存。

## 为什么会有这么多个进程
现代浏览器采用的都是多进程浏览器，每个进程处理一个任务。 以chrome浏览器为例，打开一个chrome浏览器最少会产生4个进程，分别是：
 1. 浏览器进程
 2. 网络进程
 3. GPU进程
 4. 页面进程（正常情况下一个页面一个进程，特殊情况下面详细讲）
 5. 插件进程（如果有插件的话，一个插件一个进程）

详细如下图：（如何查看下图这种详细的进程，chrome右上角三个点 --> 更多工具 --> 任务管理器）
![avatar](img/chrome.png)  

特殊情况下，两个页面会共用一个页面进程：
chrome 默认每个页面一个进程，特殊情况：如果你从当前页面进入另一个新的页面，而且新页面的域名和当前页面一样，那么新页面会共用当前页面的页面进程


## 为什么chrome要创建这么多进程，以前的单进程架构不好吗？
之前的单进程架构存在的问题：

* 不流畅

插件：插件和页面使用同一个进程，插件会堵塞页面的加载。  
js: 其他页面js的死循环或者页面资源加载慢会导致整个浏览器的其他页面加载都卡死或变慢。  

* 不安全

插件：插件的权限过大，可以读取和修改本地文件，甚至修改电脑配置文件(使用c/c++编写的插件，可以完全控制你的电脑)。 
js: js可以通过浏览器的漏洞获取电脑权限，接浏览器之手修改本机配置。 

* 不稳定

插件：插件大部分是第三方编写的，水平参差不齐，崩溃也是家常便饭，插件的崩溃将直接导致浏览器无响应或崩溃。  
js: 一个页面js的死循环或崩溃将导致其他页面也卡死或崩溃。 

所以在多年的研究、开发后，多进程架构c位出道，基本解决了这些的问题：

* 流畅性：

插件和页面的js只能影响自己的进程，死循环或资源加载慢只能影响自己。(当然 现代浏览器特别吃cpu和内存资源，cpu内存吃满了还是会卡，多进程浏览器的缺点)  
* 安全性

安全沙箱：系统对进程使用沙箱机制，无法写数据，只能读有限的数据，通常是你当前域名下载的文件，将恶意插件和js的后门堵死了。  
* 稳定性：

因为进程间是相互隔离的，所以当一个页面或一个插件崩溃时，仅仅只会影响到当前页面和那个插件本身，完美解决一颗老鼠屎的问题。
