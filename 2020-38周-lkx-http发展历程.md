# 引言

HTTP/2 相比于 HTTP/1.1，大幅度提高了网页的性能，只需要升级到该协议就可以减少很多之前需要做的性能优化工作。虽然 HTTP/2 提高了网页的性能，但是并不代表它已经是完美的了，HTTP/3 就是为了解决 HTTP/2 所存在的一些问题而被推出来的。

# HTTP演变和发展

## HTTP/1.1发明以来发生了哪些变化？
HTTP/1.1自从1997年发布以来，已经使用HTTP/1.x 相当长一段时间了，但是随着近十年互联网的爆炸式发展，从当初网页内容以文本为主,到现在以富媒体（如图片、声音、视频）为主,而且对页面内容实时性高要求的应用越来越多(比如聊天、视频直播),于是当时协议规定的某些特性，已经无法满足现代网络的需求了。

## HTTP/1.1的缺陷
* 高延迟--带来页面加载速度降低

主要由于队头阻塞，导致带宽无法被充分利用。队头阻塞是指当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一并被阻塞，会导致客户端迟迟收不到数据。

解决方法：
1. 将同一页面的资源分散到不同域名下，提升连接上限，Chrome有个机制，对于同一个域名，默认允许同时建立6个TCP持久连接，使用持久连接时，虽然能公用一个TCP管道，但是在一个管道中同一时刻只能处理一个请求，在当前请求没结束之前，其他请求只能处于阻塞状态，如果同一个域名下同时有10个请求发送，则其中4个请求会进入排队等待状态，知道进行中的请求完成
2. Spriting合并多张小图为一张大图
3. 内联是另外一种防止发送很多小图请求的技巧，将图片原始数据嵌入css文件里的url，减少网络请求

* 无状态特效--带来巨大的HTTP头部

由于报文Header一般会携带"User Agent""Cookie""Accept""Server"等许多固定的头字段,会造成头重脚轻，Header里携带的内容过大，在一定程度上增加了传输的成本。更要命的是，成千上万的请求响应报文里有很多字段值都是重复的，非常浪费。
* 明文传输--带来的不安全

HTTP/1.1在传输数据时，所有传输的内容都是明文，客户端和服务器端都无法验证对方的身份，这在一定程度上无法保证数据的安全性。
* 不支持服务器推送消息

## SPDY 协议与 HTTP/2 简介
HTTP/1.1有两个主要的缺点：安全不足和性能不高.SPDY位于HTTP之下，TCP和SSL之上，这样可以轻松兼容老版本的HTTP协议(将HTTP1.x的内容封装成一种新的frame格式)，同时可以使用已有的SSL功能。

![avatar](img/spdy.png)

SPDY 协议在Chrome浏览器上证明可行以后，就被当作 HTTP/2 的基础，主要特性都在 HTTP/2 之中得到继承。

2015年，HTTP/2 发布。HTTP/2是现行HTTP协议（HTTP/1.x）的替代，但它不是重写，HTTP方法/状态码/语义都与HTTP/1.x一样。HTTP/2基于SPDY，专注于性能，最大的一个目标是在用户和网站间只用一个连接。

## HTTP/2新特性
* 二进制传输

二进制传输是HTTP/2传输数据量的大幅减少的主要原因之一,另一个是Header压缩。

HTTP/2 采用二进制格式传输数据，而非HTTP/1.x 里纯文本形式的报文 ，二进制协议解析起来更高效。 HTTP/2 将请求和响应数据分割为更小的帧，并且它们采用二进制编码。它把TCP协议的部分特性挪到了应用层，把原来的"Header+Body"的消息"打散"为数个小片的二进制"帧"(Frame),用"HEADERS"帧存放头数据、"DATA"帧存放实体数据。HTP/2数据分帧后"Header+Body"的报文结构就完全消失了，协议看到的只是一个个的"碎片"。

HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流。每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。多个帧之间可以乱序发送，根据帧首部的流标识可以重新组装。

* Header压缩

HTTP/2并没有使用传统的压缩算法，而是开发了专门的"HPACK”算法，在客户端和服务器两端建立“字典”，用索引号表示重复的字符串，还采用哈夫曼编码来压缩整数和字符串，可以达到50%~90%的高压缩率。

![avatar](img/header.png)

由图可知看出，请求1发送了所有的头部字段，第二个请求值发送差异数据，减少冗余数据，降低开销。

* 多路复用

![avatar](img/多路复用.png)

多路复用的技术可以只通过一个 TCP 连接就可以传输所有的请求数据。

* Server Push

HTTP2还在一定程度上改变了传统的“请求-应答”工作模式，服务器不再是完全被动地响应请求，也可以新建“流”主动向客户端发送消息。比如，在浏览器刚请求HTML的时候就提前把可能会用到的JS、CSS文件发给客户端，减少等待的延迟，这被称为"服务器推送"。
* 提高安全性

出于兼容的考虑，HTTP/2延续了HTTP/1的“明文”特点，可以像以前一样使用明文传输数据，不强制使用加密通信，不过格式还是二进制，只是不需要解密。

由于HTTPS已经是大势所趋，而且主流的浏览器Chrome、Firefox等都公开宣布只支持加密的HTTP/2，所以“事实上”的HTTP/2是加密的。也就是说，互联网上通常所能见到的HTTP/2都是使用"https”协议名，跑在TLS上面。HTTP/2协议定义了两个字符串标识符：“h2"表示加密的HTTP/2，“h2c”表示明文的HTTP/2。

## HTTP/3新特性

### HTTP/2缺点
* TCP 以及 TCP+TLS建立连接的延时：两个握手延迟
* TCP的队头阻塞并没有彻底解决（丢包重传）

为什么不直接去修改 TCP 协议？其实这已经是一件不可能完成的任务了。因为 TCP 存在的时间实在太长，已经充斥在各种设备中，并且这个协议是由操作系统实现的，更新起来不大现实。

### HTTP/3简介
Google 在推SPDY的时候就已经意识到了这些问题，于是就另起炉灶搞了一个基于 UDP 协议的“QUIC”协议，让HTTP跑在QUIC上而不是TCP上。
而这个“HTTP over QUIC”就是HTTP协议的下一个大版本，HTTP/3。它在HTTP/2的基础上又实现了质的飞跃，真正“完美”地解决了“队头阻塞”问题。

![avatar](img/http.png)

QUIC 虽然基于 UDP，但是在原本的基础上新增了很多功能，接下来我们重点介绍几个QUIC新功能。

### QUIC新功能
QUIC基于UDP，而UDP是“无连接”的，根本就不需要“握手”和“挥手”，所以就比TCP来得快。具体特点如下：

* 实现了类似TCP的流量控制、传输可靠性的功能。
* 实现了快速握手功能。
* 集成了TLS加密功能。
* 多路复用，彻底解决TCP中队头阻塞的问题

# 总结
1. HTTP/1.1有两个主要的缺点：安全不足和性能不高。
2. HTTP/2完全兼容HTTP/1，是“更安全的HTTP、更快的HTTPS"，头部压缩、多路复用等技术可以充分利用带宽，降低延迟，从而大幅度提高上网体验；
3. QUIC 基于 UDP 实现，是 HTTP/3 中的底层支撑协议，该协议基于 UDP，又取了 TCP 中的精华，实现了即快又可靠的协议


[HTTP/2和HTTP/3的特性](https://juejin.im/post/6844903968380813325)
